{{/*
ConfigMap for Floe CompiledArtifacts

This ConfigMap holds the compiled_artifacts.json generated by `floe compile`.
It's mounted into Dagster containers to provide:
- dbt profiles configuration
- Dagster pipeline definitions
- Target compute engine settings

Covers: 007-FR-001 (Helm chart for Kubernetes deployment)
Covers: 007-FR-008 (CompiledArtifacts as ConfigMap)
*/}}
{{- if .Values.floe.compiledArtifacts.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "floe-dagster.fullname" . }}-compiled-artifacts
  labels:
    {{- include "floe-dagster.labels" . | nindent 4 }}
  annotations:
    {{- with .Values.floe.compiledArtifacts.annotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
data:
  {{- if .Values.floe.compiledArtifacts.content }}
  compiled_artifacts.json: |
    {{- .Values.floe.compiledArtifacts.content | nindent 4 }}
  {{- else }}
  # Placeholder - replace with actual compiled artifacts
  # Generate with: floe compile --output compiled_artifacts.json
  compiled_artifacts.json: |
    {
      "version": "1.0.0",
      "metadata": {
        "generated_at": "{{ now | date "2006-01-02T15:04:05Z07:00" }}",
        "generator": "floe-helm-placeholder"
      },
      "dbt_profiles": {},
      "dagster_config": {}
    }
  {{- end }}
{{- end }}
