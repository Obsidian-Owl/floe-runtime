{{- if .Values.demoCredentials.enabled }}
# Kubernetes Secret for Demo Credentials (Local Development)
#
# WARNING: This file contains plain credentials for LOCAL DEVELOPMENT ONLY.
# NEVER use plain secrets in staging/production environments.
#
# Production alternatives:
#   - Sealed Secrets (encrypted, safe to commit)
#   - External Secrets Operator (sync from AWS Secrets Manager, Vault, etc.)
#   - SOPS (encrypted YAML)
#
# This secret provides credentials for:
#   - Polaris catalog (OAuth2 client credentials)
#   - LocalStack S3 (AWS credentials)
#   - PostgreSQL (Dagster metadata database)
#
# Covers: Three-Tier Architecture (Tier 3 - K8s Secret Management)
apiVersion: v1
kind: Secret
metadata:
  name: floe-demo-credentials
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: {{ include "floe-infrastructure.name" . }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    app.kubernetes.io/component: credentials
    app.kubernetes.io/part-of: floe-platform
    helm.sh/chart: {{ include "floe-infrastructure.chart" . }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
type: Opaque
stringData:
  # Polaris OAuth2 credentials
  # These match the demo_client created by polaris-init job
  polaris-client-id: {{ .Values.demoCredentials.polarisClientId | quote }}
  polaris-client-secret: {{ .Values.demoCredentials.polarisClientSecret | quote }}

  # LocalStack AWS credentials
  # LocalStack accepts any credentials for local development
  aws-access-key-id: {{ .Values.demoCredentials.awsAccessKeyId | quote }}
  aws-secret-access-key: {{ .Values.demoCredentials.awsSecretAccessKey | quote }}

  # PostgreSQL credentials (Dagster metadata database)
  # These must match the postgresql chart values
  postgresql-password: {{ .Values.demoCredentials.postgresqlPassword | quote }}
  postgresql-username: {{ .Values.demoCredentials.postgresqlUsername | quote }}

  # Cube semantic layer credentials
  # API secret for Cube authentication
  cube-api-secret: {{ .Values.demoCredentials.cubeApiSecret | default "floe-demo-secret-change-in-production" | quote }}
  # SQL API password for PostgreSQL wire protocol
  cube-sql-password: {{ .Values.demoCredentials.cubeSqlPassword | default "cube_password" | quote }}
{{- end }}
