{{- if .Values.localstack.enabled }}
# LocalStack Service - Exposes AWS-compatible APIs
# Single endpoint for all AWS services (S3, STS, IAM, Secrets Manager)
# Port 4566 is the unified gateway port for all services
apiVersion: v1
kind: Service
metadata:
  name: {{ .Release.Name }}-localstack
  labels:
    {{- include "floe-infrastructure.labels" . | nindent 4 }}
    app.kubernetes.io/component: localstack
spec:
  {{- if and .Values.localAccess .Values.localAccess.enabled }}
  type: NodePort
  {{- else }}
  type: ClusterIP
  {{- end }}
  ports:
    - port: 4566
      targetPort: gateway
      protocol: TCP
      name: gateway
      {{- if and .Values.localAccess .Values.localAccess.enabled .Values.localAccess.nodeports }}
      nodePort: {{ .Values.localAccess.nodeports.localstack | default 30566 }}
      {{- end }}
  selector:
    {{- include "floe-infrastructure.selectorLabels" . | nindent 4 }}
    app.kubernetes.io/component: localstack
{{- end }}
