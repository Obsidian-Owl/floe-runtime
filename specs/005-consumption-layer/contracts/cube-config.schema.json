{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://floe.dev/schemas/cube-config.schema.json",
  "title": "CubeConfig",
  "description": "Runtime configuration for Cube deployment generated by floe-cube",
  "type": "object",
  "required": ["database_type"],
  "additionalProperties": false,
  "properties": {
    "database_type": {
      "type": "string",
      "enum": ["postgres", "snowflake", "bigquery", "databricks", "trino"],
      "description": "Database driver type for Cube connections"
    },
    "api_port": {
      "type": "integer",
      "minimum": 1024,
      "maximum": 65535,
      "default": 4000,
      "description": "REST/GraphQL API port"
    },
    "sql_port": {
      "type": "integer",
      "minimum": 1024,
      "maximum": 65535,
      "default": 15432,
      "description": "SQL API port (Postgres wire protocol)"
    },
    "api_secret_ref": {
      "type": ["string", "null"],
      "pattern": "^[a-zA-Z0-9][a-zA-Z0-9_-]{0,252}$",
      "description": "Kubernetes secret reference for API secret"
    },
    "dev_mode": {
      "type": "boolean",
      "default": false,
      "description": "Enable Cube Playground for development"
    },
    "pre_aggregations_schema": {
      "type": "string",
      "default": "pre_aggregations",
      "description": "Database schema for pre-aggregation tables"
    },
    "export_bucket": {
      "type": ["string", "null"],
      "description": "S3 bucket URI for pre-aggregation storage"
    },
    "jwt_audience": {
      "type": ["string", "null"],
      "description": "Expected JWT audience claim for validation"
    },
    "jwt_issuer": {
      "type": ["string", "null"],
      "description": "Expected JWT issuer claim for validation"
    },
    "row_level_security": {
      "type": "object",
      "description": "User-managed, role-based row-level security configuration. Distinct from SaaS tenant isolation.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable row-level security filtering"
        },
        "filter_column": {
          "type": "string",
          "default": "organization_id",
          "description": "Column name for row-level security filtering (e.g., organization_id, department, region)"
        },
        "filter_claim": {
          "type": "string",
          "default": "organization_id",
          "description": "JWT claim name to extract filter value from (e.g., u.organization_id)"
        }
      }
    },
    "pre_aggregations": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "refresh_schedule": {
          "type": "string",
          "default": "*/30 * * * *",
          "description": "Cron expression for pre-aggregation refresh"
        },
        "timezone": {
          "type": "string",
          "default": "UTC",
          "description": "Timezone for schedule evaluation"
        }
      }
    }
  }
}
