# Local Development Platform Configuration
#
# Environment: local
# Purpose: Local development and testing with Docker Compose
#
# This configuration is used by:
#   - testing/docker/ integration tests
#   - Local development via `make test`
#
# Usage:
#   export FLOE_PLATFORM_ENV=local
#   floe validate
#   floe compile
#
# Required environment variables (injected by polaris-init):
#   POLARIS_CLIENT_ID      - OAuth2 client ID for Polaris
#   POLARIS_CLIENT_SECRET  - OAuth2 client secret for Polaris
#   AWS_ACCESS_KEY_ID      - LocalStack S3 access key (default: "test")
#   AWS_SECRET_ACCESS_KEY  - LocalStack S3 secret key (default: "test")
#
# Infrastructure:
#   - Storage: LocalStack S3 (http://localstack:4566)
#   - Catalog: LocalStack Polaris (http://polaris:8181)
#   - Observability: Jaeger + Marquez

version: "1.0.0"

storage:
  default:
    type: s3
    # LocalStack S3 endpoint - used by testing/docker infrastructure
    endpoint: "http://localstack:4566"
    region: us-east-1
    bucket: iceberg-data
    path_style_access: true
    credentials:
      mode: static
      # Secret resolved from AWS_ACCESS_KEY_ID / AWS_SECRET_ACCESS_KEY env vars
      secret_ref: aws-credentials

catalogs:
  default:
    type: polaris
    uri: "http://polaris:8181/api/catalog"
    warehouse: warehouse
    namespace: default
    credentials:
      mode: oauth2
      # client_id resolved from POLARIS_CLIENT_ID env var
      client_id:
        secret_ref: polaris-client-id
      client_secret:
        secret_ref: polaris-client-secret
      scope: "PRINCIPAL_ROLE:ALL"
    # Disable vended credentials for LocalStack (LocalStack doesn't support STS properly)
    access_delegation: none
    token_refresh_enabled: true

compute:
  default:
    type: duckdb
    properties:
      path: ":memory:"
      threads: 4
    credentials:
      mode: static

observability:
  traces: true
  metrics: true
  lineage: true
  otlp_endpoint: "http://jaeger:4317"
  lineage_endpoint: "http://marquez:5000"
  attributes:
    service.name: floe-local
    deployment.environment: local
