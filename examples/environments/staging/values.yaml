# Staging Environment Values
#
# Production-like settings with moderate resources.
# Use for integration testing and pre-production validation.
#
# Usage:
#   helm upgrade --install floe-runtime ./charts/floe-runtime \
#     -f examples/environments/staging/values.yaml \
#     -n floe-staging
#
# Covers: 007-FR-003 (environment promotion pipeline)

# floe-dagster subchart overrides
floe-dagster:
  enabled: true

  dagster:
    dagsterWebserver:
      replicaCount: 2
      resources:
        requests:
          cpu: 250m
          memory: 512Mi
        limits:
          cpu: 1000m
          memory: 1Gi

    dagsterDaemon:
      resources:
        requests:
          cpu: 250m
          memory: 512Mi
        limits:
          cpu: 1000m
          memory: 1Gi

    # Use external PostgreSQL for staging
    postgresql:
      enabled: false
    externalPostgresql:
      host: "staging-postgres.example.com"
      port: 5432
      database: "dagster_staging"
      # User/password via external secrets

  floe:
    compiledArtifacts:
      enabled: true
      configMapName: "floe-staging-artifacts"

# floe-cube subchart overrides
floe-cube:
  enabled: true

  api:
    replicaCount: 2
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi

  refreshWorker:
    enabled: true
    replicaCount: 2

  cubeStore:
    enabled: false  # Use external storage

  # External storage for pre-aggregations
  database:
    type: trino

# Global staging settings
global:
  imagePullSecrets:
    - name: registry-credentials

  annotations:
    environment: "staging"

  labels:
    app.kubernetes.io/environment: "staging"
