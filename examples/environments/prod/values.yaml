# Production Environment Values
#
# High availability, production resource limits, all security enabled.
#
# Usage:
#   helm upgrade --install floe-runtime ./charts/floe-runtime \
#     -f examples/environments/prod/values.yaml \
#     -n floe-prod
#
# Covers: 007-FR-003 (environment promotion pipeline)

# floe-dagster subchart overrides
floe-dagster:
  enabled: true

  dagster:
    dagsterWebserver:
      replicaCount: 3
      resources:
        requests:
          cpu: 500m
          memory: 1Gi
        limits:
          cpu: 2000m
          memory: 2Gi

      # Production: enable HPA
      autoscaling:
        enabled: true
        minReplicas: 3
        maxReplicas: 10
        targetCPUUtilizationPercentage: 70

    dagsterDaemon:
      resources:
        requests:
          cpu: 500m
          memory: 1Gi
        limits:
          cpu: 2000m
          memory: 2Gi

    # External PostgreSQL (managed service)
    postgresql:
      enabled: false
    externalPostgresql:
      host: "prod-postgres.example.com"
      port: 5432
      database: "dagster_prod"
      sslMode: "require"

  floe:
    compiledArtifacts:
      enabled: true
      configMapName: "floe-prod-artifacts"

# floe-cube subchart overrides
floe-cube:
  enabled: true

  api:
    replicaCount: 3
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 2Gi

  refreshWorker:
    enabled: true
    replicaCount: 3
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 2Gi

  cubeStore:
    enabled: false  # Use external storage (S3/GCS)

  database:
    type: trino

  # Production ingress
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: cube.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: cube-tls
        hosts:
          - cube.example.com

# Global production settings
global:
  imagePullSecrets:
    - name: registry-credentials

  annotations:
    environment: "production"

  labels:
    app.kubernetes.io/environment: "prod"
