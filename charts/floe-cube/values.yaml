# Floe Cube Helm Chart Values
#
# Default configuration values for floe-cube chart.
# Override in values-dev.yaml or values-prod.yaml for environment-specific settings.
#
# Covers: 007-FR-001 (Helm chart for Kubernetes deployment)
# Covers: 007-FR-002 (Cube semantic layer deployment)

# Name overrides
nameOverride: ""
fullnameOverride: ""

# Development mode (enables Cube playground)
devMode: false

# Cube API server configuration
api:
  # Number of API server replicas
  replicaCount: 1

  # Image configuration
  image:
    repository: cubejs/cube
    tag: "v0.36"
    pullPolicy: IfNotPresent

  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Service configuration
  service:
    type: ClusterIP
    port: 4000
    annotations: {}

  # SQL API (Postgres wire protocol)
  sqlApi:
    enabled: false
    port: 15432

  # Pod annotations
  podAnnotations: {}

  # Extra environment variables
  extraEnv: []
  # - name: CUBEJS_LOG_LEVEL
  #   value: "debug"

  # Environment from ConfigMaps/Secrets
  envFrom: []
  # - secretRef:
  #     name: cube-secrets

  # Extra volume mounts
  extraVolumeMounts: []

  # Extra volumes
  extraVolumes: []

# Cube refresh worker configuration
refreshWorker:
  enabled: true
  replicaCount: 1

  # Refresh interval in seconds
  refreshTimer: 30

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Pod annotations
  podAnnotations: {}

  # Extra environment variables
  extraEnv: []

  # Environment from ConfigMaps/Secrets
  envFrom: []

  # Extra volume mounts
  extraVolumeMounts: []

  # Extra volumes
  extraVolumes: []

# Pre-aggregation configuration
# Pre-aggregations are materialized rollups that improve query performance
preAggregations:
  # Use external storage (Cube Store) for pre-aggregations
  # Set to false for testing (uses source database storage)
  # Set to true for production (uses Cube Store with S3/GCS)
  external: true

  # Scheduled refresh settings
  scheduledRefresh:
    enabled: true
    timezone: "UTC"

  # Export bucket for large pre-aggregation builds (Trino/Snowflake only)
  # Required for datasets > 100k rows
  # Note: DuckDB does NOT support export buckets - uses batching only
  exportBucket:
    enabled: false
    type: ""  # s3 or gcs
    name: ""
    region: ""
    # Credentials via secrets
    secretName: ""
    accessKeyKey: "access-key"
    secretKeyKey: "secret-key"
    # Snowflake storage integration name
    integration: ""

# Cube store configuration (for pre-aggregations)
cubeStore:
  enabled: false
  # Use external storage (S3/GCS) for pre-aggregations by default
  # Enable this for self-hosted Cube Store

  replicaCount: 1

  image:
    repository: cubejs/cubestore
    tag: "v0.36"
    pullPolicy: IfNotPresent

  # S3 configuration for pre-aggregation storage
  s3:
    bucket: ""
    region: ""
    endpoint: ""  # For MinIO/LocalStack
    # Credentials via secrets
    secretName: ""
    accessKeyKey: "access-key"
    secretKeyKey: "secret-key"

  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

  # Persistent storage for Cube Store data
  persistence:
    enabled: false
    accessMode: ReadWriteOnce
    size: 10Gi
    # storageClass: ""

  # Pod annotations
  podAnnotations: {}

  # Extra environment variables
  extraEnv: []

  # Extra volume mounts
  extraVolumeMounts: []

# Floe-specific configuration
floe:
  # Cube schema directory (generated from floe compile)
  schemaPath: "/app/schema"

  # dbt manifest path for model references
  dbtManifestPath: "/app/.floe/manifest.json"

  # CompiledArtifacts ConfigMap mount
  compiledArtifacts:
    enabled: true
    configMapName: ""
    mountPath: "/app/.floe/compiled_artifacts.json"

# Database connection (set via secrets)
database:
  # Database type: trino, snowflake, bigquery, postgres
  type: trino
  # Connection configured via environment variables from secrets

# External secrets configuration
externalSecrets:
  enabled: false
  provider: ""
  secretStoreRef: ""

# Inline Cube schema files
# Alternative to mounting from ConfigMap
schema: {}
# Example:
# schema:
#   orders.js: |
#     cube(`Orders`, {
#       sql: `SELECT * FROM orders`,
#       measures: { count: { type: `count` } },
#       dimensions: { status: { sql: `status`, type: `string` } }
#     });

# Image pull secrets for private registries
imagePullSecrets: []

# Pod security context
podSecurityContext: {}
# fsGroup: 1000

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Service account
serviceAccount:
  create: false
  name: ""

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  # nginx.ingress.kubernetes.io/rewrite-target: /
  hosts:
    - host: cube.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  # - secretName: cube-tls
  #   hosts:
  #     - cube.local
