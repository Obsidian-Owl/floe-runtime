# Demo Environment Values
#
# Configuration for running the demo e-commerce pipeline.
# Use with: helm upgrade --install floe-dagster . -f values-demo.yaml
#
# This demo showcases:
# - Synthetic data generation
# - dbt medallion architecture (staging → intermediate → marts)
# - Cube semantic layer consumption
# - Dagster orchestration with schedules and sensors
#
# Covers: 007-FR-029 (E2E validation tests)
# Covers: 007-FR-031 (Medallion architecture demo)

# Enable Dagster subchart
dagster:
  enabled: true

  # Dagster webserver configuration
  dagsterWebserver:
    replicaCount: 1
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi

    # Demo-specific environment variables
    env:
      - name: FLOE_DEMO_CATALOG
        value: "floe_demo"
      - name: FLOE_DEMO_SCHEMA
        value: "raw"
      - name: DAGSTER_HOME
        value: "/opt/dagster"

  # Dagster daemon for schedules and sensors
  dagsterDaemon:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

  # Use embedded PostgreSQL for demo
  postgresql:
    enabled: true
    auth:
      password: "demo-password"
      postgresPassword: "demo-password"
    primary:
      persistence:
        size: 5Gi

# Floe-specific demo settings
floe:
  # Demo project configuration
  demo:
    enabled: true
    # Polaris catalog connection
    polaris:
      uri: "http://polaris:8181/api/catalog"
      warehouse: "floe_demo"
    # Cube API connection
    cube:
      apiUrl: "http://cube:4000"
      sqlHost: "cube"
      sqlPort: 15432

  # CompiledArtifacts for demo pipeline
  compiledArtifacts:
    enabled: true
    configMapName: "floe-demo-artifacts"
    mountPath: "/app/.floe/compiled_artifacts.json"
    content: |
      {
        "version": "1.0.0",
        "project_name": "floe-demo",
        "metadata": {
          "compiled_at": "2024-01-01T00:00:00Z",
          "compiler_version": "1.0.0"
        },
        "targets": {
          "demo": {
            "compute": "duckdb",
            "catalog": {
              "type": "polaris",
              "uri": "http://polaris:8181/api/catalog"
            }
          }
        }
      }

  # dbt configuration for demo models
  dbt:
    projectPath: "/workspace/demo"
    profilesDir: "/workspace/demo"
    target: "demo"

  # Observability
  observability:
    tracing:
      enabled: true
      endpoint: "http://jaeger:4318"
    lineage:
      enabled: false
      marquezUrl: "http://marquez:5000"

# Image configuration
image:
  repository: ghcr.io/obsidian-owl/floe-runtime
  tag: "demo"
  pullPolicy: IfNotPresent

# Demo ingress for local access
ingress:
  enabled: true
  className: ""
  annotations: {}
  hosts:
    - host: dagster.demo.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Service account
serviceAccount:
  create: true
  name: "floe-demo"

# Pod security context
podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
