#!/usr/bin/env bash
# Git pre-push hook - runs CI checks locally before push
# Install with: git config core.hooksPath .githooks

set -e

echo "ðŸ” Running pre-push validation..."

# Run the check script
if [ -x "scripts/check.sh" ]; then
    ./scripts/check.sh
else
    echo "âš ï¸  scripts/check.sh not found, running inline checks..."
    uv run ruff check .
    uv run ruff format --check .
    uv run mypy --strict packages/*/src/

    # Helm chart validation (required)
    if command -v helm &> /dev/null; then
        echo "âŽˆ Linting Helm charts..."
        helm lint charts/floe-dagster/
        helm lint charts/floe-cube/
    else
        echo "ERROR: helm CLI not found. Install with: brew install helm" >&2
        exit 1
    fi

    uv run pytest packages/*/tests/ -q
fi

echo "âœ… Pre-push checks passed!"
