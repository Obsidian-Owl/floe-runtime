#!/usr/bin/env bash
# Git pre-commit hook - auto-formats and validates staged files
# Install with: git config core.hooksPath .githooks
# Or run: make hooks

set -e

echo "ðŸŽ¨ Running pre-commit checks..."

# Get list of staged Python files
STAGED_PY_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)

if [ -n "$STAGED_PY_FILES" ]; then
    echo "   Formatting staged Python files..."

    # Format only staged files
    echo "$STAGED_PY_FILES" | xargs uv run ruff format

    # Re-add formatted files to staging
    echo "$STAGED_PY_FILES" | xargs git add

    # Run lint check on staged files
    echo "   Checking for lint errors..."
    echo "$STAGED_PY_FILES" | xargs uv run ruff check --fix

    # Re-add any auto-fixed files
    echo "$STAGED_PY_FILES" | xargs git add
fi

echo "âœ… Pre-commit checks passed!"
